<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Vagrant Examples by 4BitBen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Vagrant Examples</h1>
      <h2 class="project-tagline">Understand Vagrant through some simple examples</h2>
      <a href="https://github.com/4BitBen/vagrant-examples" class="btn">View on GitHub</a>
      <a href="https://github.com/4BitBen/vagrant-examples/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/4BitBen/vagrant-examples/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h2>
<a id="welcome-to-vagrant-examples" class="anchor" href="#welcome-to-vagrant-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Welcome to Vagrant Examples</h2>

<p>Vagrant examples is meant help someone new to Vagrant better understand what Vagrant is and what its features are.</p>

<h2>
<a id="what-is-vagrant" class="anchor" href="#what-is-vagrant" aria-hidden="true"><span class="octicon octicon-link"></span></a>What is Vagrant</h2>

<p>Vagrant is a tool that interacts with a VM provider, like <a href="https://www.virtualbox.org/">VirtualBox</a> or <a href="http://www.parallels.com/">Parallels</a> to create and configure VMs, like configuring network adapters to use <a href="http://en.wikipedia.org/wiki/Network_address_translation">NAT</a> or <a href="http://en.wikipedia.org/wiki/Bridging_(networking)">Bridged</a>. It then interacts with the newly created VM to provision the VM, like setting the hostname and IP address as well as installing software on the VM. Vagrant does this in an automated way and is meant to be version controlled along side source code.</p>

<h2>
<a id="what-vagrant-is-not" class="anchor" href="#what-vagrant-is-not" aria-hidden="true"><span class="octicon octicon-link"></span></a>What Vagrant is not</h2>

<p>Vagrant is not a VM provider. It just interacts with a VM provider through that provider's APIs.</p>

<h2>
<a id="use-cases" class="anchor" href="#use-cases" aria-hidden="true"><span class="octicon octicon-link"></span></a>Use Cases</h2>

<h4>
<a id="developer-environment" class="anchor" href="#developer-environment" aria-hidden="true"><span class="octicon octicon-link"></span></a>Developer Environment</h4>

<p>Vagrant can be used to create a developer environment to easily create the necessary build tools so that all developers have a consistent environment.</p>

<h4>
<a id="play-with-technology" class="anchor" href="#play-with-technology" aria-hidden="true"><span class="octicon octicon-link"></span></a>Play with Technology</h4>

<p>Vagrant can be used to play with interesting software, like <a href="http://nginx.org/">nginx</a> or the <a href="https://www.elastic.co/webinars/elk-stack-devops-environment">ELK stack</a>. You can play with the software without having to worry about impacting your developer machine.</p>

<h4>
<a id="simulate-environments" class="anchor" href="#simulate-environments" aria-hidden="true"><span class="octicon octicon-link"></span></a>Simulate environments</h4>

<p>Vagrant can be used to simulate distributed environments. You can install a 3-node database cluster and simulate machines going up and down or partition machines from each other.</p>

<h2>
<a id="still-interested-lets-get-started" class="anchor" href="#still-interested-lets-get-started" aria-hidden="true"><span class="octicon octicon-link"></span></a>Still Interested? Let's Get Started</h2>

<h3>
<a id="pre-requisite" class="anchor" href="#pre-requisite" aria-hidden="true"><span class="octicon octicon-link"></span></a>
<a name="prereq"></a>Pre-Requisite</h3>

<p>Before creating the first VM, some initial setup needs to be done.</p>

<ol>
<li>Download/Install <a href="http://www.vagrantup.com/downloads.html">Vagrant</a>
</li>
<li>
<p>Download/Install a VM Provider - e.g. <a href="https://www.virtualbox.org/wiki/Downloads">Virtualbox</a> for Windows or <a href="http://www.parallels.com/products/desktop/download/">Parallels</a> for Mac</p>

<p>a. <strong>(Parallels-Only)</strong> Install the parallels plugin</p>

<pre><code>vagrant plugin install vagrant-parallels   
</code></pre>

<p>b. <strong>(Parallels-Only)</strong> Setting parallels as the default provider</p>

<pre><code>export VAGRANT_DEFAULT_PROVIDER=parallels
</code></pre>

<p>Or add it to your ~/.bashrc</p>
</li>
<li>
<p>(Optional) Add the main box we will be using. This will speed up creating the initial VM.</p>

<pre><code>$ vagrant box add boxcutter/centos71
NOTE: This will prompt you for the VM provider you are using. Enter the number based off what you installed in step #2 above.

1) parallels
2) virtualbox
3) vmware_desktop

Enter your choice: 
</code></pre>
</li>
</ol>

<h3>
<a id="get-started" class="anchor" href="#get-started" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get Started</h3>

<p>Click on the Download link above to get some vagrant examples, and extract the contents into a folder. All examples below assume you are in the folder that has the LICENSE file.</p>

<hr>

<h3>
<a id="example-1-simple-vm" class="anchor" href="#example-1-simple-vm" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example 1: Simple VM</h3>

<p>Let's create a Virtual Machine.</p>

<pre><code>cd 1_simple
vagrant up
</code></pre>

<p>Vagrant will output some information</p>

<pre><code>==&gt; default: Importing base box 'boxcutter/centos71'...
==&gt; default: Matching MAC address for NAT networking...
==&gt; default: Checking if box 'boxcutter/centos71' is up to date...
==&gt; default: Setting the name of the VM: 1_simple_default_1432041878529_74810
==&gt; default: Fixed port collision for 22 =&gt; 2222. Now on port 2201.
==&gt; default: Clearing any previously set network interfaces...
==&gt; default: Preparing network interfaces based on configuration...
    default: Adapter 1: nat
==&gt; default: Forwarding ports...
    default: 22 =&gt; 2201 (adapter 1)
==&gt; default: Booting VM...
==&gt; default: Waiting for machine to boot. This may take a few minutes...
    default: SSH address: 127.0.0.1:2201
    default: SSH username: vagrant
    default: SSH auth method: private key
    default: Warning: Connection timeout. Retrying...
    default:
    default: Vagrant insecure key detected. Vagrant will automatically replace
    default: this with a newly generated keypair for better security.
    default:
    default: Inserting generated public key within guest...
    default: Removing insecure key from the guest if its present...
    default: Key inserted! Disconnecting and reconnecting using new SSH key...
==&gt; default: Machine booted and ready!
==&gt; default: Checking for guest additions in VM...
==&gt; default: Mounting shared folders...
    default: /vagrant =&gt; C:/temp/4BitBen-vagrant-examples-533ed11/1_simple
</code></pre>

<p>And now you have your first VM created. Your VM provider knows about this VM as well. Bring up the VM provider's GUI and look at the newly created VM.</p>

<p>Let's break down how Vagrant created the VM. </p>

<h4>
<a id="vagrantfile" class="anchor" href="#vagrantfile" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="http://docs.vagrantup.com/v2/vagrantfile/index.html">Vagrantfile</a>
</h4>

<p>The first thing that Vagrant needs is a Vagrantfile. A Vagrantfile is the main configuration item defining how to create the Virtual Machine - e.g. network settings, # of CPUs, Memory, etc. Vagrant looks in the current working directory for a Vagrantfile. Here is what our Vagrantfile looks like</p>

<pre><code># -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure(2) do |config|
  config.vm.box = "boxcutter/centos71"
end
</code></pre>

<p>The only thing our Vagrantfile defines is the Box. Every Vagrantfile must define at least a Box.</p>

<h4>
<a id="box" class="anchor" href="#box" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="http://docs.vagrantup.com/v2/boxes.html">Box</a>
</h4>

<p>Once Vagrant has found the Vagrantfile and reads it, it will try to download the Box. A box is a base image. Vagrant essentially uses the base image to quickly clone a virtual machine. By default, Vagrant looks locally to see if this box has already been downloaded. If not, Vagrant looks in <a href="https://www.vagrantcloud.com">Vagrant Cloud</a> for the box and then downloads.</p>

<pre><code>==&gt; default: Importing base box 'boxcutter/centos71'...
</code></pre>

<p>Downloaded boxes are stored in </p>

<pre><code>$HOME/.vagrant.d/boxes/&lt;box_name&gt;/&lt;version&gt;/&lt;provider&gt;. 
</code></pre>

<p>If you look, it is an extremely small wrapper around how the Provider stores the Virtual Machine.</p>

<h4>
<a id="create-and-configure-vm" class="anchor" href="#create-and-configure-vm" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create and Configure VM</h4>

<p>Once the box has been imported, the VM gets created and configured - e.g. network adapters are created and configured for the VM.</p>

<pre><code>==&gt; default: Setting the name of the VM: 1_simple_default_1432041878529_74810
==&gt; default: Fixed port collision for 22 =&gt; 2222. Now on port 2201.
==&gt; default: Clearing any previously set network interfaces...
==&gt; default: Preparing network interfaces based on configuration...
    default: Adapter 1: nat
==&gt; default: Forwarding ports...
    default: 22 =&gt; 2201 (adapter 1)
</code></pre>

<p>Here the VM is using Network Address Translation for its networking. It is also configuring the VM Provider to do Port Forwarding.</p>

<h4>
<a id="provision-vm" class="anchor" href="#provision-vm" aria-hidden="true"><span class="octicon octicon-link"></span></a>Provision VM</h4>

<p>Once the VM has been created and configured, it now gets provisioned - e.g. setting IP address(es), hostname, etc.</p>

<pre><code>==&gt; default: Booting VM...
==&gt; default: Waiting for machine to boot. This may take a few minutes...
    default: SSH address: 127.0.0.1:2201
    default: SSH username: vagrant
    default: SSH auth method: private key
    default: Warning: Connection timeout. Retrying...
    default:
    default: Vagrant insecure key detected. Vagrant will automatically replace
    default: this with a newly generated keypair for better security.
    default:
    default: Inserting generated public key within guest...
    default: Removing insecure key from the guest if its present...
    default: Key inserted! Disconnecting and reconnecting using new SSH key...
==&gt; default: Machine booted and ready!
</code></pre>

<h4>
<a id="playing-around" class="anchor" href="#playing-around" aria-hidden="true"><span class="octicon octicon-link"></span></a>Playing around</h4>

<p>Now that the VM has been created, configured, and provisioned, feel free to log onto the VM and play around.</p>

<pre><code>vagrant ssh
</code></pre>

<p>Vagrant requires from default settings in order for it to interact with the VM. Here are a few requirements:</p>

<ul>
<li>vagrant username with a password of vagrant</li>
<li>vagrant user is configured for password-less sudo</li>
</ul>

<p>A full list of the requirements can be found <a href="http://docs.vagrantup.com/v2/boxes/base.html">here</a></p>

<p>Once you are done playing inside the VM, you can exit and shutdown the VM.</p>

<pre><code>exit
vagrant halt
</code></pre>

<p>You can also control the VM from the command line:</p>

<p><strong>Startup</strong></p>

<pre><code>vagrant up
</code></pre>

<p><strong>Suspend</strong></p>

<pre><code>vagrant suspend
</code></pre>

<p><strong>Shutdown</strong></p>

<pre><code>vagrant halt
</code></pre>

<p><strong>Destroy</strong></p>

<pre><code>vagrant destroy
</code></pre>

<h4>
<a id="further-reading" class="anchor" href="#further-reading" aria-hidden="true"><span class="octicon octicon-link"></span></a>Further Reading</h4>

<p>You can specify memory and cpu settings for each provider.</p>

<pre><code>  config.vm.provider "virtualbox" do |vb|
    vb.cpus = 2
    vb.memory = 512
  end

  config.vm.provider "parallels" do |pl|
    pl.cpus = 2
    pl.memory = 512
  end
</code></pre>

<ul>
<li>
<a href="http://docs.vagrantup.com/v2/virtualbox/configuration.html">Virtualbox Configuration</a> - Virtualbox-specific configuration</li>
<li>
<a href="https://parallels.github.io/vagrant-parallels/docs/configuration.html">Parallels Configuration</a> - Parallels-specific configuration</li>
<li>
<a href="http://docs.vagrantup.com/v2/">Vagrant Documentation</a> - Read more about Vagrant</li>
<li>
<a href="https://vagrantcloud.com/">Vagrant Cloud</a> - Find pre-built Vagrant boxes</li>
</ul>

<hr>

<h3>
<a id="example-2-network" class="anchor" href="#example-2-network" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example 2: Network</h3>

<p>Without specifying a network in the Vagrantfile, the default may vary by provider. Vagrant allows the ability to configure a private network, a public (aka bridged) network, or do port forwarding.</p>

<p>Let's create a Virtual Machine with a private network.</p>

<pre><code>cd 2_networking
vagrant up
</code></pre>

<p>The Vagrantfile here differs from the VagrantFile in Example 1 by two lines:</p>

<pre><code>config.vm.network "private_network", ip: "192.168.50.2"
config.vm.host_name = "my-host"
</code></pre>

<p>These two lines do a few things. First, Vagrant interacts with the VM Provider to create an additional network adapter:</p>

<pre><code>==&gt; default: Preparing network interfaces based on configuration...
    default: Adapter 1: nat
    default: Adapter 2: hostonly
</code></pre>

<p>This can be confirmed by looking at the network settings for the VM.</p>

<p>Second, Vagrant interacts with the VM, to set the IP address and the hostname:</p>

<pre><code>==&gt; default: Setting hostname...
==&gt; default: Configuring and enabling network interfaces...
</code></pre>

<h4>
<a id="playing-around-1" class="anchor" href="#playing-around-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Playing around</h4>

<p>Now that the VM has been created, configured, and provisioned, feel free to log onto the VM and play around.</p>

<pre><code>vagrant ssh
</code></pre>

<p>Try looking at a few things, like the hostname or IP.</p>

<pre><code># Hostname
hostname
# IPs
ip addr show
</code></pre>

<p>Once you are done playing inside the VM, you can exit and shutdown the VM.</p>

<pre><code>exit
vagrant halt
</code></pre>

<h4>
<a id="futher-reading" class="anchor" href="#futher-reading" aria-hidden="true"><span class="octicon octicon-link"></span></a>Futher Reading</h4>

<ul>
<li>
<a href="http://docs.vagrantup.com/v2/networking/index.html">Vagrant's network support</a>.</li>
</ul>

<hr>

<h3>
<a id="example-4-synced-folders" class="anchor" href="#example-4-synced-folders" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example 4: Synced Folders</h3>

<p>Vagrant can sync folders from the Host OS into the VM. By default, Vagrant syncs the current working directory into the /vagrant folder on the VM.</p>

<p>Vagrant support other synchronization options - NFS, RSync, and SMB (windows host only) </p>

<p>NOTE: These other options typically require 3rd party software installed or are OS specific.</p>

<p>Let's create a Virtual Machine with a synced folder.</p>

<pre><code>cd 3_syncedfolders
vagrant up
</code></pre>

<p>The Vagrantfile here differs from the VagrantFile in Example 1 by one line:</p>

<pre><code>config.vm.synced_folder "..", "/vagrant-examples-default"
</code></pre>

<p>An additional entry is seen in the Vagrant output:</p>

<pre><code>==&gt; default: Mounting shared folders...
    default: /vagrant =&gt; C:/temp/4BitBen-vagrant-examples-533ed11/3_syncedfolders
    default: /vagrant-examples-default =&gt; C:/temp/4BitBen-vagrant-examples-533ed11
</code></pre>

<h4>
<a id="playing-around-2" class="anchor" href="#playing-around-2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Playing around</h4>

<p>Now that the VM has been created, configured, and provisioned, feel free to log onto the VM and play around.</p>

<pre><code>vagrant ssh
</code></pre>

<p>Look at the contents of the /vagrant and /vagrant-examples-default.</p>

<pre><code>ls /vagrant
ls /vagrant-examples-default
touch /vagrant/foo.bar
ls /vagrant
ls /vagrant-examples-default
</code></pre>

<p>Once you are done playing inside the VM, you can exit and shutdown the VM.</p>

<pre><code>exit
vagrant halt
</code></pre>

<h4>
<a id="futher-reading-1" class="anchor" href="#futher-reading-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Futher Reading</h4>

<ul>
<li>
<a href="http://docs.vagrantup.com/v2/synced-folders/">Vagrant's synced folder support</a>.</li>
<li>
<a href="http://mitchellh.com/comparing-filesystem-performance-in-virtual-machines">Comparing Filesystem Performance in VMs</a> - Further look at sync folders</li>
</ul>

<hr>

<h3>
<a id="example-5-provisioning" class="anchor" href="#example-5-provisioning" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example 5: Provisioning</h3>

<p>Vagrant can use multiple provisioning tools to configure the VM - install software, create users, etc. A few provisioners it supports are the following:</p>

<ul>
<li>Shell Scripts</li>
<li>Ansible</li>
<li>Chef</li>
<li>Puppet</li>
<li>Salt</li>
<li>Many More...</li>
</ul>

<p>Vagrant does not restrict the user to just one provisioner. Many provisioners can be defined and will be executed in order. </p>

<p>Let's create a Virtual Machine with some provisioners.</p>

<pre><code>cd 4_provision
vagrant up
</code></pre>

<p>The Vagrantfile here differs from the VagrantFile in Example 1 by a few lines:</p>

<pre><code>  # Install Puppet
  config.vm.provision "shell"  do |shell|
    shell.inline = "
sudo rpm -ivh http://yum.puppetlabs.com/puppetlabs-release-el-7.noarch.rpm
sudo yum install -y puppet
sudo cp /vagrant/repo/nginx.repo /etc/yum.repos.d/
"
  end

  # Run Puppet Script
  config.vm.provision "puppet"  do |puppet|
    puppet.manifests_path = "puppet"
    puppet.manifest_file = "default.pp"
  end

  # Tell the user what to do
  config.vm.provision "shell"  do |shell|
    shell.inline = "echo Complete! Bring your browser up and go to #{ip}"
  end
</code></pre>

<p>Here, three provisioners are defined:</p>

<ol>
<li>A shell script provisioner that installs puppet (since this Vagrant box does not come pre-packaged with puppet) as well as configures yum to look at the nginx repo.</li>
</ol>

<pre><code>==&gt; default: Running provisioner: shell...
    default: Running: inline script
....
</code></pre>

<ol>
<li>A puppet provisioner that runs default.pp (the contents of default.pp installs nginx and makes sure it is running as a linux service).</li>
</ol>

<pre><code>==&gt; default: Running provisioner: puppet...
==&gt; default: Running Puppet with default.pp...
==&gt; default: Notice: Compiled catalog for localhost in environment production in 0.61 seconds
==&gt; default: Notice: /Stage[main]/Main/Package[nginx]/ensure: created
==&gt; default: Notice: /Stage[main]/Main/Service[nginx]/ensure: ensure changed 'stopped' to 'running'
==&gt; default: Notice: Finished catalog run in 19.35 seconds
</code></pre>

<ol>
<li>A shell script provisioner that echos that everything is complete.</li>
</ol>

<pre><code>==&gt; default: Running provisioner: shell...
    default: Running: inline script
==&gt; default: Complete! Bring your browser up and go to 192.168.50.4
</code></pre>

<h4>
<a id="playing-around-3" class="anchor" href="#playing-around-3" aria-hidden="true"><span class="octicon octicon-link"></span></a>Playing around</h4>

<p>Now that the VM has been created, configured, and provisioned, feel free to log onto the VM and play around.</p>

<pre><code>vagrant ssh
</code></pre>

<p>Once you are done playing inside the VM, you can exit and shutdown the VM.</p>

<pre><code>exit
vagrant halt
</code></pre>

<h4>
<a id="futher-reading-2" class="anchor" href="#futher-reading-2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Futher Reading</h4>

<ul>
<li>
<a href="https://docs.vagrantup.com/v2/provisioning/">Vagrant's provisioning support</a>.</li>
</ul>

<hr>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/4BitBen/vagrant-examples">Vagrant Examples</a> is maintained by <a href="https://github.com/4BitBen">4BitBen</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-62489653-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>

